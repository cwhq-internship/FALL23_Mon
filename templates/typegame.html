{% extends "layout.html" %}
{% set title="Typing game" %}
{% block e %} active-bar {% endblock %}
{% block styles %}
    <link href='{{url_for("static", filename="stylesheets/layout.css")}}' rel='stylesheet'/>
    <link href='{{url_for("static", filename="stylesheets/typegame.css")}}' rel='stylesheet'/>
{% endblock %}

{% block content %}
<body>
    <div class="outer">
      <div id="bubbles-box">
        <div id="game-container">
          <button id="start" type="button" onclick="startCountdown()">Click to start game!</button>
        </div>
      </div>
  
      <div class="inputs">
        <div class="rowboard">
          <div class="scoreboard">
            <div class="scorelabel">
              <p>Score:</p>
              <span id="word-count" class="h3 text-center">0</span>
            </div>
          </div>
          <div class="scoreboard">
            <div class="scorelabel">
              <p>Time Left:</p>
              <span id="timer">30</span>
            </div>
          </div>
        </div>
        <input type="text" id="typing-bar" placeholder="Type here">
      </div>
    </div>
  
    <div id="game-over">
      <p>Game Over!</p>
      <p id="wpm">Words Per Minute: 0</p>
      <p id="final-count">Words Typed: 0</p>
      <a href="typegame">
        <button id="playagain"><p>Play Again</p></button>
      </a>
    </div>

    <script>
        const words = ['spell', 'wand', 'enchant', 'mage', 'dragon', 'wizard', 'elixir'];
        const bubbleSpeed = 2; 
    
        function createBubble(word) {
          const bubble = document.createElement('div');
          bubble.className = 'bubble';
          bubble.textContent = word;
          bubble.style.left = `${Math.random() * (window.innerWidth - 60)}px`;
          bubble.style.top = `${window.innerHeight}px`;
          document.body.appendChild(bubble);
    
          bubble.onclick = function() {
            bubble.remove();
            spawnBubble();
          };
    
          moveBubble(bubble);
        }
    
        function moveBubble(bubble) {
          const speed = bubbleSpeed;
          const move = () => {
            const currentTop = parseInt(bubble.style.top, 10);
            bubble.style.top = `${currentTop - speed}px`;
    
            if (currentTop > -50) {
              requestAnimationFrame(move);
            } else {
              bubble.remove();
              spawnBubble();
            }
          };
    
          move();
        }
    
        function spawnBubble() {
          const word = words[Math.floor(Math.random() * words.length)];
          createBubble(word);
        }
    
        function initializeGame() {
          const existingBubbles = document.querySelectorAll('.bubble');
          existingBubbles.forEach((bubble) => bubble.remove());
    
          for (let i = 0; i < 5; i++) {
            spawnBubble();
          }
    
          document.getElementById('game-over').style.display = 'none';
          document.getElementById('play-again-btn').style.display = 'none';
        }
    
        document.addEventListener('DOMContentLoaded', () => {
          initializeGame();
        });
    
        
        const typingBar = document.getElementById('typing-bar');
        typingBar.addEventListener('input', () => {
          const typedWord = typingBar.innerText.trim().toLowerCase();
          const bubbles = document.querySelectorAll('.bubble');
    
          let allBubblesPopped = true;
    
          bubbles.forEach((bubble) => {
            const bubbleWord = bubble.textContent.toLowerCase();
            if (typedWord === bubbleWord) {
              bubble.remove();
              spawnBubble();
              typingBar.innerText = '';
            } else {
              allBubblesPopped = false;
            }
          });
    
          if (allBubblesPopped) {
            endGame();
          }
        });
    
        
        function endGame() {
          document.getElementById('game-over').style.display = 'block';
          document.getElementById('play-again-btn').style.display = 'block';
          document.getElementById('play-again-btn').addEventListener('click', initializeGame);
        }


    
// Darkmode Script!
document.addEventListener("DOMContentLoaded", function() {
    const darkModeToggle = document.getElementById("dark-mode-toggle");
    const navbar = document.getElementById("navbar");
    const darkmodetext = document.querySelector(".darkmodetext");
  
    // Function to set dark mode styles
    function enableDarkMode() {
        document.body.style.backgroundImage = "url('/static/img/darkbackground.png')";
        navbar.classList.remove("navbar-light");
        navbar.classList.add("navbar-dark");
        darkmodetext.classList.add("darkmodetext2");
        // Save dark mode preference to localStorage
        localStorage.setItem("darkModeEnabled", "true");
    }
  
    // Function to set light mode styles
    function disableDarkMode() {
        document.body.style.backgroundImage = "url('/static/img/background.png')";
        navbar.classList.remove("navbar-dark");
        navbar.classList.add("navbar-light");
        darkmodetext.classList.remove("darkmodetext2");
        // Save light mode preference to localStorage
        localStorage.setItem("darkModeEnabled", "false");
    }
  
    // Event listener for dark mode toggle change
    darkModeToggle.addEventListener("change", () => {
        if (darkModeToggle.checked) {
            // Enable dark mode
            enableDarkMode();
        } else {
            // Disable dark mode
            disableDarkMode();
        }
    });
  
    // Function to apply navbar styles based on dark mode preference
    function applyNavbarStyles(isDarkMode) {
        if (isDarkMode) {
            navbar.classList.remove("navbar-light");
            navbar.classList.add("navbar-dark");
        } else {
            navbar.classList.remove("navbar-dark");
            navbar.classList.add("navbar-light");
        }
    }
  
    // Check and apply dark mode setting from localStorage on page load
    const isDarkModeEnabled = localStorage.getItem("darkModeEnabled") === "true";
    if (isDarkModeEnabled) {
        darkModeToggle.checked = true;
        enableDarkMode(); // Apply dark mode styles if enabled in localStorage
        applyNavbarStyles(true); // Apply navbar styles based on dark mode preference
    } else {
        disableDarkMode(); // Apply light mode styles by default
        applyNavbarStyles(false); // Apply navbar styles based on light mode preference
    }
  });
  </script>
  
  </body>
  </html>
{% endblock %}