{% extends 'layout.html' %}
{% set title="Paragraph" %}
{% block styles %}
    <link href='{{url_for("static", filename="stylesheets/paragraph.css")}}' rel='stylesheet'/>
    <link href='{{url_for("static", filename="stylesheets/layout.css")}}' rel='stylesheet'/>
{% endblock %}
{% block e %} active-bar {% endblock %}
{% block content %}
<div id="race-container">
    <p id="countdown"></p>
    <p id="text-to-type"></p>
    <textarea type="text" id="user-input" rows="6" cols="65" disabled></textarea>
    <p id="time">0s</p>
    <p id="wpm"></p>
    <p id="countdown"></p>
    <p id="quote-source"></p>

    <button id="retry-btn" onclick="startCountdown()">Retry</button>
  </div>
  <script>
    document.addEventListener("DOMContentLoaded", function () {
    const quotes = [
        { text: "When I found out the patriarchy wasn't about horses, I lost interest anyway.", source: "Barbie (2023)" },// "Barbie (2023)"
        { text: "Humans only have one ending. Ideas live forever.", source: "Barbie (2023)" },// "Barbie (2023)"
        { text: "Why should Caesar get to stomp around like a giant while the rest of us try not to get smushed under his big feet? What's so great about Caesar, hm? Brutus is just as cute as Caesar. Brutus is just as smart as Caesar, people totally like Brutus as much as they like Caesar. WE SHOULD TOTALLY JUST STAB CAESAR!", source: "Mean Girls (2004)" },// "Mean Girls (2004)"
        { text: "What Do You Mean 'Broke'? Like, Martha Stewart 'Broke'? Or MC Hammer 'Broke?'", source: "White Chicks (2004)" }// "White Chicks (2004)"
        // Add more quotes as needed
    ];

    const textElement = document.getElementById("text-to-type");
    const userInput = document.getElementById("user-input");
    const timerElement = document.getElementById("time");
    const wpmElement = document.getElementById("wpm");
    const countdownElement = document.getElementById("countdown");
    const retryButton = document.getElementById("retry-btn");
    const quoteSourceElement = document.getElementById("quote-source");

    let timerInterval;
    let countdownInterval;

    function startCountdown() {
        countdownElement.innerText = "3";
        let countdown = 3;

        countdownInterval = setInterval(function () {
            countdown--;

            if (countdown <= 0) {
                clearInterval(countdownInterval);
                countdownElement.style.display = "none";
                startGame();
            } else {
                countdownElement.innerText = countdown;
            }
        }, 1000);
    }

    function startGame() {
        const randomIndex = Math.floor(Math.random() * quotes.length);
        const randomQuote = quotes[randomIndex];

        textElement.innerText = randomQuote.text;
        quoteSourceElement.innerText = ""; // Reset source
        userInput.removeAttribute("disabled");
        userInput.value = "";
        userInput.style.color = "black"; // Reset to default color
        userInput.focus();

        retryButton.style.display = "none";
        timerInterval = setInterval(function () {
            updateTimer();
        }, 1000);
    }

    function endGame() {
        clearInterval(timerInterval);
        clearInterval(countdownInterval);
        userInput.setAttribute("disabled", "true");
        retryButton.style.display = "block";

        // Display the quote source when the game ends
        quoteSourceElement.innerText = `Quote from: ${getCurrentQuote().source}`;

        retryButton.addEventListener("click", startCountdown);
    }

    function updateTimer() {
        const timerValue = parseInt(timerElement.innerText);
        timerElement.innerText = timerValue + 1 + "s";
    }

    function getCurrentQuote() {
        const currentText = textElement.innerText.trim();
        return quotes.find(quote => quote.text === currentText) || { source: "Unknown" };
    }

    userInput.addEventListener("input", function () {
        const userInputText = userInput.value.trim();
        const targetText = textElement.innerText.trim();

        if (userInputText === targetText) {
            userInput.style.color = "black"; // Reset to default color

            const words = userInputText.split(/\s+/);
            const wordCount = words.length;

            if (userInputText === targetText) {
                const wpm = calculateWPM(wordCount, parseInt(timerElement.innerText));
                wpmElement.innerText = "WPM: " + wpm;
                endGame();
            }
        }
    });

    function calculateWPM(words, time) {
        const minutes = time / 60;
        const wpm = Math.round(words / minutes);
        return wpm;
    }

    retryButton.addEventListener("click", startCountdown);

    startCountdown();
});
</script>
{% endblock %}