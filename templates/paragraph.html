{% extends 'layout.html' %}
{% set title="Paragraph" %}
{% block styles %}
    <link href='{{url_for("static", filename="stylesheets/paragraph.css")}}' rel='stylesheet'/>
    <link href='{{url_for("static", filename="stylesheets/layout.css")}}' rel='stylesheet'/>
{% endblock %}
{% block e %} active-bar {% endblock %}
{% block content %}
<div id="race-container">
    <p id="text-to-type"></p>
    <textarea type="text" id="user-input" rows="6" cols="65" disabled></textarea>
    <p id="time">0s</p>
    <p id="wpm"></p>
    <p id="countdown"></p>
    <p id="quote-source"></p>

    <button id="retry-btn" onclick="startCountdown()">Retry</button>
  </div>
  <script>
    document.addEventListener("DOMContentLoaded", function () {
    const quotes = [
        { text:"When I found out the patriarchy wasn't about horses, I lost interest anyway.", source: "Barbie (2023)" },// "Barbie (2023)"
        { text:"Humans only have one ending. Ideas live forever.", source: "Barbie (2023)" },// "Barbie (2023)"
        { text:"Why should Caesar get to stomp around like a giant while the rest of us try not to get smushed under his big feet? What's so great about Caesar, hm? Brutus is just as cute as Caesar. Brutus is just as smart as Caesar, people totally like Brutus as much as they like Caesar. WE SHOULD TOTALLY JUST STAB CAESAR!", source: "Mean Girls (2004)" },// "Mean Girls (2004)"
        { text:"What Do You Mean 'Broke'? Like, Martha Stewart 'Broke'? Or MC Hammer 'Broke?'", source: "White Chicks (2004)" },// "White Chicks (2004)"
        { text:"So, OK, like right now, for example, the Haitians need to come to America. But some people are all, \"what about the strain on our resources?\" But it's like when I had this garden party for my father's birthday, right? I said RSVP because it was a sit-down dinner. But people came that, like, did not RSVP. So I was, like, totally buggin'. I had to haul ass to the kitchen, redistribute the food, squish in extra place settings. But, by the end of the day it was, like, the more the merrier!", source: "Cher Horowitz" },
        { text:"Everything is simply a shape, a form, an identifier to let others recognize me as me! But then, what am I? Is this me? My true self? My fake self? What is it that I am? Nobody understands me!", source: "Shinji Ikari" },
        { text:"Life is not a waste of time. And time is not a waste of life. So let's stop wasting time, get wasted, and have the time of our lives.", source: "Pitbull - Mr. Worldwide" },
        { text:"I don't want to live in a hole anymore. It makes me feel poor. We are poor, but we're happy. Comme-ci, comme-ga. Anyway, the views are better above ground. I'm seven non-fox-years old now. My father died at seven and a half. I don't want to live in a hole anymore, and I'm going to do something about it.", source: "Fantastic Mr. Fox" },
        { text:"I don't talks about feelings, Alfred. I don't have any, I've never seen one. I'm a night-stalking, crime-fighting vigilante, and a heavy metal rapping machine. I don't feel anything emotionally, except for rage.", source: "Lego Batman" }
        // Add more quotes as needed
    ];

    const textElement = document.getElementById("text-to-type");
    const userInput = document.getElementById("user-input");
    const timerElement = document.getElementById("time");
    const wpmElement = document.getElementById("wpm");
    const countdownElement = document.getElementById("countdown");
    const retryButton = document.getElementById("retry-btn");
    const quoteSourceElement = document.getElementById("quote-source");

    let timerInterval;
    let countdownInterval;

    function startCountdown() {
        countdownElement.innerText = "3";
        let countdown = 3;

        countdownInterval = setInterval(function () {
            countdown--;

            if (countdown <= 0) {
                clearInterval(countdownInterval);
                countdownElement.style.display = "none";
                startGame();
            } else {
                countdownElement.innerText = countdown;
            }
        }, 1000);
    }

    function startGame() {
        const randomIndex = Math.floor(Math.random() * quotes.length);
        const randomQuote = quotes[randomIndex];

        textElement.innerText = randomQuote.text;
        quoteSourceElement.innerText = "";
        userInput.value = "";
        userInput.style.color = "black";
        userInput.focus();

        retryButton.style.display = "none";
        timerInterval = setInterval(function () {
            updateTimer();
        }, 1000);
    }

    function endGame() {
        clearInterval(timerInterval);
        clearInterval(countdownInterval);
        userInput.setAttribute("disabled", "true");
        retryButton.style.display = "block";

        quoteSourceElement.innerText = `Quote from: ${getCurrentQuote().source}`;

        retryButton.addEventListener("click", startCountdown);
    }

    function updateTimer() {
        const timerValue = parseInt(timerElement.innerText);
        timerElement.innerText = timerValue + 1 + "s";
    }

    function getCurrentQuote() {
        const currentText = textElement.innerText.trim();
        return quotes.find(quote => quote.text === currentText) || { source: "Unknown" };
    }

    userInput.addEventListener("input", function () {
        const userInputText = userInput.value.trim();
        const targetText = textElement.innerText.trim();

        if (userInputText === targetText) {
            userInput.style.color = "black";

            const words = userInputText.split(/\s+/);
            const wordCount = words.length;

            if (userInputText === targetText) {
                const wpm = calculateWPM(wordCount, parseInt(timerElement.innerText));
                wpmElement.innerText = "WPM: " + wpm;
                endGame();
            }
        }
    });

    function calculateWPM(words, time) {
        const minutes = time / 60;
        const wpm = Math.round(words / minutes);
        return wpm;
    }

    retryButton.addEventListener("click", startCountdown);

    startCountdown();
});
</script>
{% endblock %}